<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ECharts</title>
    <!-- 引入 echarts.js -->
    <script src="echarts.min.js"></script>
    <!-- <script src="//api.map.baidu.com/api?v=1.0&type=webgl&ak=z0Cg46TcAmhdnVrWLskZ9zhII8fpReIk"></script> -->
    <script src="common.js"></script>
    <!-- <script src="//mapv.baidu.com/build/mapv.min.js"></script> -->
    <script src="https://code.bdstatic.com/npm/mapvgl@1.0.0-beta.125/dist/mapvgl.min.js"></script>
    <script src="tools.js"></script>
</head>

<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="main" style="width: 600px;height:400px;"></div>

    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));

        // 师兄读取数据的代码
        ajaxPost('https://www.lexue.ltd/urban/getBlueskyData/2013', '', temp1)//请求13年的数据
        // ajaxPost('https://www.lexue.ltd/urban/getBlueskyData/2014', '', temp2)//请求14年的数据
        // ajaxPost('https://www.lexue.ltd/urban/getBlueskyData/2015', '', temp3)//请求15年的数据
        // ajaxPost('https://www.lexue.ltd/urban/getBlueskyData/2016', '', temp4)//请求16年的数据
        // ajaxPost('https://www.lexue.ltd/urban/getBlueskyData/2017', '', temp5)//请求17年的数据
        // ajaxPost('https://www.lexue.ltd/urban/getBlueskyData/2018', '', temp6)//请求18年的数据
        // ajaxPost('https://www.lexue.ltd/urban/getBlueskyData/2019', '', temp7)//请求19年的数据
        // ajaxPost('https://www.lexue.ltd/urban/getBlueskyData/2020', '', temp8)//请求20年的数据
        // ajaxPost('https://www.lexue.ltd/urban/getBlueskyData/2021', '', temp9)//请求21年的数据

        // 读取13年的数据
        function temp1(res) {
            console.log(res);
            for (let i = 0; i < res.length; i++) {
                let data = res[i].pm25AqiToBlueSkyTotal   //读取根据PM2.5计算AQI得到的蓝天数
                let jdData = res[i].urbanagglomeration   //读取城市群名
                // for (let j = 0; j < arr.length; j++) {
                //     data.push({                          //再从城市各项指标数组中获取经纬度
                //         geometry: {
                //             //type: 'Point',
                //             // coordinates: [arr1[j].lon, arr1[j].lat] //经纬度
                //         },
                //         properties: {
                //             count: i
                //         }
                //     })
                // }
            }
        }
        // // 读取14年的数据
        // function temp2(res) {
        //     console.log(res);
        //     for (let i = 0; i < res.length; i++) {
        //         let data = res[i].pm25AqiToBlueSkyTotal   //读取根据PM2.5计算AQI得到的蓝天数
        //     }
        //     console.log(data);//网页显示数据，无关紧要
        //     // console.log(jdData);
        // }

        var years = ['2013'];
        // var jdData = [
        //     ['粤港澳大湾区', '中原城市群', '长江中游城市群', '京津冀城市群', '滇中城市群', '山东半岛城市群', '成渝城市群', '辽中南城市群', '北部湾城市群', '关中平原城市群', '呼包鄂榆城市群', '长江三角城市群', '兰西城市群', '晋中城市群', '海峡西岸城市群', '宁夏沿黄城市群', '哈长城市群', '黔中城市群', '天山北坡经济带'],
        //     // ['粤港澳大湾区', '中原城市群', '长江中游城市群', '京津冀城市群', '滇中城市群', '山东半岛城市群', '成渝城市群', '辽中南城市群', '北部湾城市群', '关中平原城市群', '呼包鄂榆城市群', '长江三角城市群', '兰西城市群', '晋中城市群', '海峡西岸城市群', '宁夏沿黄城市群', '哈长城市群', '黔中城市群', '天山北坡经济带'],
        //     // ['粤港澳大湾区', '中原城市群', '长江中游城市群', '京津冀城市群', '滇中城市群', '山东半岛城市群', '成渝城市群', '辽中南城市群', '北部湾城市群', '关中平原城市群', '呼包鄂榆城市群', '长江三角城市群', '兰西城市群', '晋中城市群', '海峡西岸城市群', '宁夏沿黄城市群', '哈长城市群', '黔中城市群', '天山北坡经济带']
        // ]
        // var data = [
        //     [13.2, 1.11, 13.6, 9284, 64138, 2237, 4779, 48877, 2371, 36224, 12956, 2499, 4778, 594, 717, 534, 16487],
        //     [15.26, 1.31, 16.68, 10331, 91580, 1909, 40469, 67490, 1765, 36982, 15371, 3643, 2871, 762, 962, 757, 34414],
        //     [14.23, 1.31, 21.13, 10873, 94964, 2966, 129748, 59827, 8519, 38344, 18495, 3531, 1369, 544, 2005, 975, 33855,],
        // ];
        // 指定图表的配置项和数据
        var option = {

            baseOption: {
                backgroundColor: '#2c343c', //背景颜色
                timeline: {
                    data: years,
                    axisType: 'category',
                    autoPlay: true,
                    playInterval: 1500, //播放速度

                    left: '5%',
                    right: '5%',
                    bottom: '0%',
                    width: '90%',
                    //  height: null,
                    label: {
                        normal: {
                            textStyle: {

                                color: 'red',
                            }
                        },
                        emphasis: {
                            textStyle: {
                                color: 'red'
                            }
                        }
                    },
                    symbolSize: 10,
                    lineStyle: {
                        color: '#red'
                    },
                    checkpointStyle: {
                        borderColor: '#red',
                        borderWidth: 2
                    },
                    controlStyle: {
                        showNextBtn: true,
                        showPrevBtn: true,
                        normal: {
                            color: '#ff8800',
                            borderColor: '#ff8800'
                        },
                        emphasis: {
                            color: 'red',
                            borderColor: 'red'
                        }
                    },

                },
                title: {
                    text: '',
                    right: '2%',
                    bottom: '8%',
                    textStyle: {
                        fontSize: 50,
                        color: 'black' //标题字体颜色
                    }
                },
                tooltip: {
                    'trigger': 'axis'
                },
                calculable: true,
                grid: {
                    left: '8%',
                    right: '2%',
                    bottom: '6%',
                    top: '0%',
                    containLabel: true
                },
                label: {
                    normal: {
                        textStyle: {
                            color: 'red'
                        }
                    }
                },
                yAxis: [{

                    nameGap: 50,
                    offset: '37',
                    'type': 'category',
                    interval: 50,
                    //inverse: ture,//图表倒叙或者正序排版
                    data: '',
                    nameTextStyle: {
                        color: 'red'
                    },


                    axisLabel: {
                        //rotate:45,
                        show: false,
                        textStyle: {
                            fontSize: 32,

                            color: function (params, Index) { // 标签国家字体颜色

                                //color:function(d){return "#"+Math.floor(Math.random()*(256*256*256-1)).toString(16);//随机生成颜色

                                var colorarrays = ['#6bc0fb', '#7fec9d', '#fedd8b', '#ffa597', '#84e4dd', '#749f83',
                                    '#ca8622', '#bda29a', '#a8d8ea', '#aa96da', '#fcbad3', '#ffffd2',
                                    '#f38181', '#fce38a', '#eaffd0', '#95e1d3', '#e3fdfd', '#749f83', '#ca8622'
                                ];

                                //console.log("111", Index, colorarrays[Index],params); //打印序列

                                return colorarrays[jdData[0].indexOf(params)];
                            },


                        }, //rotate:45,
                        interval: 50
                    },
                    axisLine: {

                        lineStyle: {
                            color: 'balck' //Y轴颜色
                        },
                    },
                    splitLine: {
                        show: false,
                        lineStyle: {
                            color: 'balck'
                        }
                    },

                }],
                xAxis: [{
                    'type': 'value',
                    'name': '',

                    splitNumber: 8, //轴线个数
                    nameTextStyle: {
                        color: 'balck'
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#ffa597' //X轴颜色
                        }
                    },
                    axisLabel: {
                        formatter: '{value} '
                    },
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: '#fedd8b'
                        }
                    },
                }],
                series: [
                    {
                        'name': '',
                        'type': 'bar',
                        markLine: {
                            label: {
                                normal: {
                                    show: false
                                }
                            },
                            lineStyle: {
                                normal: {
                                    color: 'red',
                                    width: 3
                                }
                            },
                        },
                        label: {
                            normal: {
                                show: true,
                                position: 'right', //数值显示在右侧
                                formatter: '{c}'
                            }
                        },
                        itemStyle: {
                            normal: {
                                color: function (params) {
                                    // build a color map as your need.
                                    //color:function(d){return "#"+Math.floor(Math.random()*(256*256*256-1)).toString(16);//随机生成颜色         
                                    var colorList = ['#6bc0fb', '#7fec9d', '#fedd8b', '#ffa597', '#84e4dd', '#749f83',
                                        '#ca8622', '#bda29a', '#a8d8ea', '#aa96da', '#fcbad3', '#ffffd2',
                                        '#f38181', '#fce38a', '#eaffd0', '#95e1d3', '#e3fdfd', '#749f83', '#ca8622'
                                    ];
                                    // return colorList[params.dataIndex]

                                    console.log("111", params.name); //打印序列
                                    return colorList[jdData[0].indexOf(params.name)];
                                },

                            }
                        },
                    },

                    {
                        'name': '',
                        'type': 'bar',
                        markLine: {
                            label: {
                                normal: {
                                    show: false
                                }
                            },
                            lineStyle: {

                                normal: {
                                    color: 'red',
                                    width: 3
                                }
                            },
                        },
                        barWidth: '50%',
                        barGap: '-100%',
                        label: {
                            normal: {
                                show: true,
                                fontSize: 16,  //标签国家字体大小
                                position: 'left', //数值显示在右侧
                                formatter: function (p) {
                                    return p.name;
                                }
                            }
                        },
                        itemStyle: {
                            normal: {
                                color: function (params) {
                                    // build a color map as your need.
                                    //color:function(d){return "#"+Math.floor(Math.random()*(256*256*256-1)).toString(16);//随机生成颜色         
                                    var colorList = ['#6bc0fb', '#7fec9d', '#fedd8b', '#ffa597', '#84e4dd', '#749f83',
                                        '#ca8622', '#bda29a', '#a8d8ea', '#aa96da', '#fcbad3', '#ffffd2',
                                        '#f38181', '#fce38a', '#eaffd0', '#95e1d3', '#e3fdfd', '#749f83', '#ca8622'
                                    ];
                                    // return colorList[params.dataIndex]

                                    // console.log("111", params.name); //打印序列
                                    return colorList[jdData[0].indexOf(params.name)];
                                },

                            }
                        },
                    }
                ],

                animationEasingUpdate: 'quinticInOut',
                animationDurationUpdate: 1500, //动画效果
            },

            options: []
        };

        for (var n = 0; n < years.length; n++) {

            var res = [];
            //alert(jdData.length);
            for (j = 0; j < data[n].length; j++) {
                res.push({
                    name: jdData[n][j],
                    value: data[n][j]
                });

            }

            res.sort(function (a, b) {
                return b.value - a.value;
            }).slice(0, 6);

            res.sort(function (a, b) {
                return a.value - b.value;
            });


            var res1 = [];
            var res2 = [];
            //console.log(res);
            for (t = 0; t < res.length; t++) {
                res1[t] = res[t].name;
                res2[t] = res[t].value;
            }
            option.options.push({
                title: {
                    text: years[n] + '年'
                },
                yAxis: {
                    data: res1,
                },
                series: [{
                    data: res2
                }, {
                    data: res2
                }]
            });
        }


        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    </script>
</body>

</html>